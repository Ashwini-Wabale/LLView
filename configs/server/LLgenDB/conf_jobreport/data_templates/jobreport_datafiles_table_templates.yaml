# Copyright (c) 2023 Forschungszentrum Juelich GmbH.
# This file is part of LLview. 
#
# This is an open source software distributed under the GPLv3 license. More information see the LICENSE file at the top level.
#
# Contributions must follow the Contributor License Agreement. More information see the CONTRIBUTING.md file at the top level.
#
# Contributors:
#    Wolfgang Frings (Forschungszentrum Juelich GmbH) 

###############################
# JOBLISTs
###############################
- dataset:
    name: template_joblist
    set:           template
    filepath:      '$outputdir/LLtemplates/joblist.handlebars'
    stat_database: jobreport_json_stat
    stat_table:    datasetstat_templates
    format:        'template'
    columns:
      %include "./jobreport_datafiles_table_templates_joblist_columns.yaml"

- dataset:
    name: template_datatable
    set:           template
    filepath:      '$outputdir/LLtemplates/datatable.handlebars'
    stat_database: jobreport_json_stat
    stat_table:    datasetstat_templates
    format:        'datatable'
    ag-grid-theme: 'balham' #quartz, balham, material, alpine (with -dark or -auto-dark suffix too)
    columns:
      %include "./jobreport_datafiles_datatable_templates_joblist_columns.yaml"

- dataset:
    name: template_joblist_history
    set:           template
    filepath:      '$outputdir/LLtemplates/joblist_history.handlebars'
    stat_database: jobreport_json_stat
    stat_table:    datasetstat_templates
    format:        'template'
    pretable:      '<div id="day_selection_scroll">
                     <div id="day_selection">
                     </div>
                    </div>'
    columns:
      # other
      - { name: lastts, sort: "N",  group: "info", title: "ended", format: "text-right", 
                   desc: "Time since end/last update of job"  }
      %include "./jobreport_datafiles_table_templates_joblist_columns.yaml"

- dataset:
    name: template_mentorlist
    set:           template
    filepath:      '$outputdir/LLtemplates/mentorlist.handlebars'
    stat_database: jobreport_json_stat
    stat_table:    datasetstat_templates
    format:        'template'
    columns:
      - { name: wsaccount,           title: "mentor",     sort: "S", data_pre: "mentor_link",
          desc: "Name of the mentor"                                                                 }
      - { name: cnt,                 title: "#projects",  sort: "N",   desc: "Number of projects handled by the mentor" }
      - { name: projects,            title: "projects",   sort: "S", format: "text-left",
          desc: "Projects handled by the mentor"           }


- dataset:
    name: template_queuedjoblist
    set:           template
    filepath:      '$outputdir/LLtemplates/queuedjobslist.handlebars'
    stat_database: jobreport_json_stat
    stat_table:    datasetstat_templates
    format:        'template'
    columns:
      - { name: jobid,           group: "queued", title: "JobID" , desc: "Slurm JobID"  }
      # Job general info
      - { name: owner,           group: "queued", sort: "S", title: "Owner", data_pre: "gen_project_user_link '/data/ll/user' account",
          desc: "User owner of the job",     format: "text-left" }
      - { name: account,         group: "queued", sort: "S", title: "Project", data_pre: "gen_project_link '/data/ll/project'",
          desc: "Budget used for job submission" ,       format: "text-left"}
      - { name: mentor,          group: "queued", sort: "S", title: "Mentor", data_pre: "gen_mentor_link '/data/ll/mentor'",
          desc: "Mentor of the project" ,       format: "text-left"}
      - { name: queue,           group: "queued", sort: "S", title: "Queue",        desc: "Slurm partition" }
      - { name: numnodes,        group: "queued", sort: "N", title: "#Nodes",       desc: "Number of nodes used by the job"  }
      - { name: state,           group: "queued", sort: "S", title: "State",        desc: "State of the Job"  }
      - { name: wall,            group: "queued", sort: "N", title: "Walltime",     desc: "Requested walltime"  }
      - { name: queuedate,       group: "queued", sort: "D", title: "Queue Date",   desc: "Date job was enqueued"  }
      - { name: runtime,         group: "queued", sort: "N", title: "Runtime",      desc: "Overall runtime"  }
      - { name: starttime,       group: "queued", sort: "D", title: "Start Date (est)",  desc: "Start date (or estimate) of the job"  }
      - { name: endtime,         group: "queued", sort: "D", title: "Est. End Date", desc: "Estimated end date of the job (Start Date + Walltime)"  }
      - { name: ArrayJobId,      group: "queued", sort: "N", title: "ArrayJobID",   desc: "Array jobID (Slurm)"  }
      - { name: ArrayTaskId,     group: "queued", sort: "N", title: "ArrayTaskID",  desc: "Array taskID (Slurm)"  }
      - { name: resid,           group: "queued", sort: "S", title: "Reservation",  format: "text-left", desc: "Reservation used by the job"  }

- dataset:
    name: template_queueddetails
    set:           template
    filepath:      '$outputdir/LLtemplates/queueddetails.handlebars'
    stat_database: jobreport_json_stat
    stat_table:    datasetstat_templates
    format:        'template'
    columns:
      - { name: userprio,        group: "queued", title: "Priority", desc: "Job priority"    }
      - { name: jobid,           group: "queued", title: "JobID", desc: "Slurm JobID"    }
      - { name: owner,           group: "queued", sort: "S", title: "Owner", data_pre: "gen_project_user_link '/data/ll/user' account",
          desc: "User owner of the job",     format: "text-left" }
      - { name: account,         group: "queued", sort: "S", title: "Project", data_pre: "gen_project_link '/data/ll/project'",
          desc: "Budget used for job submission" , format: "text-left"}
      - { name: mentor,          group: "queued", sort: "S", title: "Mentor", data_pre: "gen_mentor_link '/data/ll/mentor'",
          desc: "Mentor of the project" , format: "text-left"}
      - { name: queue,           group: "queued", sort: "S", title: "Queue",  desc: "Slurm partition" }
      
      - { name: numnodes,        group: "queued", sort: "N", title: "#Nodes",    desc: "Number of nodes used by the job"  }
      - { name: state,           group: "queued", sort: "S", title: "State",  desc: "State of the Job"  }
      - { name: qos,             group: "queued", sort: "N", title: "QOS",     desc: "Quality of Service (normal, lowcont, nocont)"  }
      - { name: wall,            group: "queued", sort: "N", title: "Walltime",   desc: "Requested walltime"  }
      - { name: restart,         group: "queued", sort: "N", title: "Restart", desc: "Number of restart cycles during preparation of nodes"  }
      
      - { name: posinqueue,      group: "queued", sort: "N", title: "Position",  desc: "Current position of job in queue"  }
      - { name: waittime,        group: "queued", sort: "N", title: "Wait Time",   desc: "Time since job was enqueued"  }
      - { name: queuedate,       group: "queued", sort: "D", title: "Queue Date",   desc: "Date job was enqueued"  }
      - { name: timetostart,     group: "queued", sort: "N", title: "Time to Start", desc: "Estimated waiting time until job starts"  }
      - { name: runtime,         group: "queued", sort: "N", title: "Runtime",     desc: "Overall runtime"  }
      
      - { name: starttime,       group: "queued", sort: "D", title: "Start Date (est)", desc: "Start date (or estimate) of the job"  }
      - { name: endtime,         group: "queued", sort: "D", title: "Est. End Date", desc:  "Estimated end date of the job (Start Date + Walltime)"   }
      - { name: reason,          group: "queued", sort: "S", title: "Reason",       format: "text-left",  desc: "Reason job could not be scheduled yet"  }
      - { name: dependency,      group: "queued", sort: "S", title: "Dependency",   format: "text-left",  desc: "Slurm job dependency"  }
      - { name: chainid,         group: "queued", sort: "S", title: "ChainID",      desc: "ID of the job chain, computed from dependency information"  }

      - { name: ArrayJobId,      group: "queued", sort: "N", title: "ArrayJobID",  desc: "Array job ID (Slurm)"  }
      - { name: ArrayTaskId,     group: "queued", sort: "N", title: "ArrayTaskID",  desc: "Array task ID (Slurm)"  }

      - { name: resid,           group: "queued", sort: "S", title: "Reservation",  format: "text-left", desc: "Reservation used by the job"  }

      
- dataset:
    name: template_workflows
    set:           template
    filepath:      '$outputdir/LLtemplates/workflows.handlebars'
    stat_database: jobreport_json_stat
    stat_table:    datasetstat_templates
    format:        'template'
    columns:
      %include "./jobreport_datafiles_table_templates_workflow_columns.yaml"

- dataset:
    name: template_reservationlist
    set:           template
    filepath:      '$outputdir/LLtemplates/reservationlist.handlebars'
    stat_database: jobreport_json_stat
    stat_table:    datasetstat_templates
    format:        'template'
    columns:
      - { name: resid,    group: "res", title: "ReservationID", sort: "S", format: "text-left", 
          desc: "ID of reservation"                                                                 }
      - { name: resname,  group: "res", title: "Name",  sort: "S", format: "text-left",
          desc: "Name of the reservation"                                                               }
      - { name: startts,  group: "res", title: "Start Date", sort: "D", format: "text-left",
          desc: "Start date of reservation"                                                         }
      - { name: endts,    group: "res", title: "End Date", sort: "D", format: "text-left",
          desc: "End date of the reservation"                                                           }
      - { name: wall,     group: "res", title: "Walltime", sort: "N", format: "text-left",
          desc: "WallTime of reservation"                                                           }
      - { name: state,    group: "res", title: "State", sort: "S", format: "text-left",
          desc: "State of the reservation"                                                           }
      - { name: numnodes,    group: "res", title: "#Nodes", sort: "N", format: "text-left",
          desc: "Number of nodes in the reservation"                                                           }
      - { name: numcores,    group: "res", title: "#Cores", sort: "N", format: "text-left",
          desc: "Number of cores in the reservation"                                                           }
      - { name: flags,    group: "res", title: "Flags", sort: "S", format: "text-left",
          desc: "Flags used in the reservation"                                                           }
      - { name: nodelist, group: "res_nodes", title: "Nodelist", sort: "S", format: "text-left",
          desc: "Nodes covered by the reservation"                                                           }
      - { name: accounts, group: "res_accounts", title: "Accounts", sort: "S", format: "text-left",
          desc: "Accounts allowed to submit jobs to the reservation"                                                           }

                                 
- dataset:
    name: template_sysstat
    set:           template
    filepath:      '$outputdir/LLtemplates/sysstat.handlebars'
    stat_database: jobreport_json_stat
    stat_table:    datasetstat_templates
    format:        'template'
    columns:
      - { name: feat,            group: "sysstat",  sort: "S", title: "Feature",   desc: "Line contains statitics about nodes which have this feature"      }
      - { name: status,          group: "sysstat",  sort: "S", title: "Status",    desc: "Status of nodes: R: Running, Id: Idle, Pl: Planned, Po: Powered Down, Do: Down, Un: Unknown" }
      - { name: substatus,       group: "sysstat",  sort: "S", title: "Substatus", desc: "Detailed status of nodes: Do: Down, Co: Completed, Dr: Drained, <br> Ma: Maintenance, Re: Reserved or Responding, NotRes: Not_Responding, Id: Idle, Pl: Planned, Al: Allocated, PowUp: Powering Up, PowDo: Powered Down" }
      - { name: count,           group: "sysstat",  sort: "N", title: "#Nodes",    desc: "Number of nodes covered by the statistics"  }

      - { name: used_cores_min,        group: "sysstat_minmax",  sort: "N", title: "Min. Used Cores", data_format: "round_number", format: "text-right",
          desc: "Minimum used cores per node"  }
      - { name: used_cores_avg,        group: "sysstat",         sort: "N", title: "Avg. Used Cores", data_format: "round_number", format: "text-right",
          desc: "Average used cores per node"  }
      - { name: used_cores_max,        group: "sysstat_minmax",  sort: "N", title: "Max. Used Cores", data_format: "round_number", format: "text-right",
          desc: "Maximum used cores per node"  }

      - { name: load_min,        group: "sysstat_minmax",  sort: "N", title: "Min. Load", data_format: "round_number", format: "text-right",
          desc: "Minimum CPU load, 1-min average among all job nodes and over time"  }
      - { name: load_avg,        group: "sysstat",         sort: "N", title: "Avg. Load", data_format: "round_number", format: "text-right",
          desc: "Average CPU load, 1-min average among all job nodes and over time"  }
      - { name: load_max,        group: "sysstat_minmax",  sort: "N", title: "Max. Load", data_format: "round_number", format: "text-right",
          desc: "Maximum CPU load, 1-min average among all job nodes and over time"  }

      - { name: used_mem_min,        group: "sysstat_minmax",  sort: "N", title: "Min. Used Memory", data_format: "round_number", format: "text-right",
          desc: "Minimum used memory per node"  }
      - { name: used_mem_avg,        group: "sysstat",         sort: "N", title: "Avg. Used Memory", data_format: "round_number", format: "text-right",
          desc: "Average used memory per node"  }
      - { name: used_mem_max,        group: "sysstat_minmax",  sort: "N", title: "Max. Used Memory", data_format: "round_number", format: "text-right",
          desc: "Maximum used memory per node"  }
          
      - { name: total_cores_avg, group: "sysstat",         sort: "N", title: "Avg. #Cores", data_format: "round_number", format: "text-right",
          desc: "Average number of cores per node"  }
      - { name: total_mem_avg,   group: "sysstat",         sort: "N", title: "Avg. Memory",      data_format: "round_number", format: "text-right",
          desc: "Average total memory per node"  }
      - { name: ts,              group: "sysstat_add",     sort: "D", title: "Last Update"    }

- dataset:
    name: template_sysenvstat
    set:           template
    filepath:      '$outputdir/LLtemplates/sysenvstat.handlebars'
    stat_database: jobreport_json_stat
    stat_table:    datasetstat_templates
    format:        'template'
    columns:
      - { name: sysname,         group: "sysstat",  sort: "S", title: "System-Name",  desc: "System Name"      }
      - { name: power,           group: "sysstat",  sort: "N", title: "Total Power Usage",    desc: "Total Power Usage (in kW)" }
      - { name: water_flowrate,  group: "sysstat",  sort: "N", title: "Water_Flowrate", desc: "Water Flow Rate (in m3/hour)" }
      - { name: water_inlet_temp,  group: "sysstat",  sort: "N", title: "Water_Inlet_Temp", desc: "Water Inlet Temperature (in C)" }
      - { name: water_outlet_temp, group: "sysstat",  sort: "N", title: "Water_Outlet_Temp", desc: "Water Outlet Temperature (in C)" }
      - { name: water_power,       group: "sysstat",  sort: "N", title: "Water_Cooling_Power", desc: "Water Cooling Power (in kW)" }
      - { name: ts,              group: "sysstat",  sort: "D", title: "Last Update"    }

- dataset:
    name: template_sysrackpwr
    set:           template
    filepath:      '$outputdir/LLtemplates/sysrackpwr.handlebars'
    stat_database: jobreport_json_stat
    stat_table:    datasetstat_templates
    format:        'template'
    columns:
      - { name: name,            group: "sysstat",  sort: "S", title: "Rack Name",  desc: "Name of the Rack"      }
      - { name: power,           group: "sysstat",  sort: "N", title: "Power Usage", desc: "Power used by the rack (in kW)" }
      - { name: ts,              group: "sysstat",  sort: "D", title: "Last Update"    }

- dataset:
    name: template_nodeerr
    set:           template
    filepath:      '$outputdir/LLtemplates/nodeerr.handlebars'
    stat_database: jobreport_json_stat
    stat_table:    datasetstat_templates
    format:        'template'
    columns:
      - { name: nodeerrts,       group: "errmsg",  sort: "D", title: "Date",  desc: "Date error was issued" }
      - { name: nodeid,          group: "errmsg",  sort: "S", title: "Node",  desc: "Node where error was issued" }
      - { name: jobid,           group: "errmsg",  sort: "S", title: "JobID", desc: "JobID", data_pre: "gen_search_jobid_link "      }
      - { name: cmd,             group: "errmsg",  sort: "S", title: "Command", desc: "Command that issued error"      }
      - { name: pid,             group: "errmsg",  sort: "N", title: "PID", desc: "ProcessID that issued error"      }
      - { name: msg,             group: "errmsg",  sort: "S", title: "Message",  desc: "Error Message", format: "text-left"      }
      - { name: msgcls,          group: "errmsg_ext",  sort: "N", title: "Message Class",  desc: "Error Message Class"  }
      - { name: user,            group: "errmsg_ext",  sort: "S", title: "User", desc: "User"      }
      - { name: uid,             group: "errmsg_ext",  sort: "N", title: "UID", desc: "UserID"      }
      - { name: gid,             group: "errmsg_ext",  sort: "N", title: "GID", desc: "GroupID"      }
      
- dataset:
    name: template_DBstat
    set:           template
    filepath:      '$outputdir/LLtemplates/DBstat.handlebars'
    stat_database: jobreport_json_stat
    stat_table:    datasetstat_templates
    format:        'template'
    columns:
      - { name: ts,              group: "DBstat",  sort: "D", title: "Last Update", desc: "Date of last update on table"   }
      - { name: ts_min,          group: "DBstat",  sort: "D", title: "Min. Date", desc: "Minimum date of entries"   }
      - { name: ts_max,          group: "DBstat",  sort: "D", title: "Max. Date", desc: "Maximum date of entries"   }
      - { name: ts_dur,          group: "DBstat",  sort: "N", title: "Time Span", desc: "Time span between minimum and maximum dates"   }
      - { name: db,              group: "DBstat",  sort: "S", title: "Database", format: "text-left", desc: "Database name"      }
      - { name: tab,             group: "DBstat",  sort: "S", title: "Table", format: "text-left", desc: "Table name"      }
      - { name: tabpath,         group: "DBstat_ext",  sort: "S", title: "Table Path", desc: "Path of the table"      }
      - { name: nrows,           group: "DBstat",  sort: "N", title: "#Rows", desc: "Number of rows stored in table"      }
      - { name: time_aggr_res,   group: "DBstat",  sort: "N", title: "TimeRes", desc: "Time resolution if table is using time_aggr, otherwise -1"      }

- dataset:
    name: template_DBgraph
    set:           template
    filepath:      '$outputdir/LLtemplates/DBgraph.handlebars'
    stat_database: jobreport_json_stat
    stat_table:    datasetstat_templates
    format:        'template'
    columns:
      - { name: db,              group: "DBgraph",  sort: "S", title: "Database",  desc: "Database name"      }
      - { name: ntabs,           group: "DBgraph",  sort: "N", title: "#tables", desc: "Number of tables in this database"      }
      - { name: nlinks,          group: "DBgraph",  sort: "N", title: "#links", desc: "Number of links between tables in this database"      } 
      - { name: LMLattr,         group: "DBgraph",  sort: "S", title: "LML import", desc: "List of attributes used by import from LML files"      } 
      - { name: ts,              group: "DBgraph",  sort: "D", title: "Last Update", desc: "Date of last update on db graph"   }

- dataset:
    name: template_steptimings
    set:           template
    filepath:      '$outputdir/LLtemplates/steptimings.handlebars'
    stat_database: jobreport_json_stat
    stat_table:    datasetstat_templates
    format:        'template'
    columns:
      - { name: wf_startts,      group: "stts",  sort: "D", title: "WF Start Date", desc: "Start date of the workflow"    }
      - { name: wf_name,         group: "stts",  sort: "S", title: "WF Name",  desc: "Workflow name"      }
      - { name: wf_cnt,          group: "stts",  sort: "N", title: "WF Counter",   desc: "Workflow counter"      }
      - { name: name,            group: "stts",  sort: "S", title: "Step Name",     desc: "Step name"      }
      - { name: startts,         group: "stts",  sort: "D", title: "Step Start Date", desc: "Start date of the step"    }
      - { name: endts,           group: "stts",  sort: "D", title: "Step End Date", desc: "End date of the workflow"    }
      - { name: dt,              group: "stts",  sort: "N", title: "Step Duration", desc: "Duration of step"      }
      - { name: cmplx,           group: "stts",  sort: "N", title: "Complexity", desc: "Number of operations in step (add/upd/del entries)"      }
      - { name: dt_min,          group: "stts_stat",  sort: "N", title: "Min. &Delta;t", desc: "Min. duration of step"      }
      - { name: dt_avg,          group: "stts_stat",  sort: "N", title: "Avg. &Delta;t", desc: "Avg. duration of step"      }
      - { name: dt_max,          group: "stts_stat",  sort: "N", title: "Max. &Delta;t", desc: "Max. duration of step"      }
      - { name: cmplx_min,       group: "stts",  sort: "N", title: "Min. Cmplx", desc: "Min. number of operations (add/upd/del entries)"      }
      - { name: cmplx_avg,       group: "stts",  sort: "N", title: "Avg. Cmplx", desc: "Avg. number of operations (add/upd/del entries)"      }
      - { name: cmplx_max,       group: "stts",  sort: "N", title: "Max. Cmplx", desc: "Max. number of operations (add/upd/del entries)"      }
      - { name: ts_min,          group: "stts",  sort: "D", title: "Min. Start Date", desc: "First date of start of step in DB"    }
      - { name: nr,              group: "stts",  sort: "N", title: "Nr", desc: "Order of execution of step within workflow"      }
      - { name: groupnr,         group: "stts",  sort: "N", title: "GroupNr", desc: "Parallel execution group number"      }

- dataset:
    name: template_activeuser
    set:           template
    filepath:      '$outputdir/LLtemplates/ActiveUser.handlebars'
    stat_database: jobreport_json_stat
    stat_table:    datasetstat_templates
    format:        'template'
    columns:
      - { name: owner,           group: "user", sort: "S", title: "User", data_pre: "gen_project_user_link '/data/ll/user' account",
          desc: "Username",         format: "text-left" }
      - { name: account,         group: "user", sort: "S", title: "Project", data_pre: "gen_project_link '/data/ll/project'",
          desc: "Budget used for job submission" ,       format: "text-left"}
      - { name: mentor,          group: "user", sort: "S", title: "Mentor", data_pre: "gen_mentor_link '/data/ll/mentor'",
          desc: "Mentor of the project" ,       format: "text-left"}
      - { name: numjobs,         group: "user",  sort: "N", title: "#Jobs (Run)",           desc: "Number of running and finished jobs in the last three weeks"  }
      - { name: nh,              group: "user",  sort: "N", title: "#Node-hour (Run)",    desc: "Total node-hours of running and finished jobs in the last three weeks", data_format: "round_number" }
      - { name: numnodes_avg,    group: "user",  sort: "N", title: "Avg. #Nodes (Run)",      desc: "Avg. number of nodes of running and finished jobs in the last three weeks", data_format: "round_number"  }
      - { name: numqueuedjobs,   group: "user",  sort: "N", title: "#Jobs Queued",        desc: "Number of currently queued jobs"  }
      - { name: qnh,             group: "user",  sort: "N", title: "#Node-hour (Queued)", desc: "Total node-hours of currently queued jobs", data_format: "round_number"  }
      - { name: qnumnodes_avg,   group: "user",  sort: "N", title: "Avg #Nodes (Queued)",   desc: "Avg. number of nodes of currently queued jobs", data_format: "round_number"  }

- dataset:
    name: template_alluser
    set:           template
    filepath:      '$outputdir/LLtemplates/AllUser.handlebars'
    stat_database: jobreport_json_stat
    stat_table:    datasetstat_templates
    format:        'template'
    columns:
      - { name: id,              group: "user", sort: "S", title: "User", desc: "Username",   format: "text-left" }
      - { name: wsaccount,       group: "user", sort: "S", title: "wsaccount",
          desc: "Web service account of the user",     format: "text-left" }
      - { name: numjobs,         group: "user",  sort: "N", title: "#Jobs", desc: "Number of queued, running and finished jobs in the last three weeks"  }
      - { name: numprojects,     group: "user",  sort: "N", title: "#Projects", desc: "Number of projects user belongs to"  }
      - { name: projects,        group: "user",  sort: "S", format: "text-left", title: "Projects",  desc: "List of projects user belongs to", data_pre: "gen_user_projects_link '/data/ll/user' id" }

- dataset:
    name: template_allmentor
    set:           template
    filepath:      '$outputdir/LLtemplates/AllMentor.handlebars'
    stat_database: jobreport_json_stat
    stat_table:    datasetstat_templates
    format:        'template'
    columns:
      - { name: id,              group: "user", sort: "S", title: "Mentor", desc: "Username of the mentor",   format: "text-left", data_pre: "gen_mentor_link '/data/ll/mentor'" }
      - { name: wsaccount,       group: "user", sort: "S", title: "wsaccount",
          desc: "Web service account of the mentor",     format: "text-left" }
      - { name: numjobs,         group: "user",  sort: "N", title: "#Jobs", desc: "Number of queued, running and finished jobs in the last three weeks"  }
      - { name: numprojects,     group: "user",  sort: "N", title: "#Projects", desc: "Number of projects user is mentor"  }
      - { name: projects,        group: "user",  sort: "S", format: "text-left", title: "Projects",  desc: "List of projects user is mentor", data_pre: "gen_projects_link '/data/ll/project'" }
      
- dataset:
    name: template_allPI
    set:           template
    filepath:      '$outputdir/LLtemplates/AllPI.handlebars'
    stat_database: jobreport_json_stat
    stat_table:    datasetstat_templates
    format:        'template'
    columns:
      - { name: id,              group: "user", sort: "S", title: "PI", desc: "Username of the PI",   format: "text-left" }
      - { name: wsaccount,       group: "user", sort: "S", title: "wsaccount",
          desc: "Web service account of the PI",     format: "text-left" }
      - { name: numjobs,         group: "user",  sort: "N", title: "#Jobs", desc: "Number of queued, running and finished jobs in the last three weeks"  }
      - { name: numprojects,     group: "user",  sort: "N", title: "#Projects", desc: "Number of projects user is PI"  }
      - { name: projects,        group: "user",  sort: "S", format: "text-left", title: "Projects",  desc: "List of projects user is PI", data_pre: "gen_projects_link '/data/ll/project'" }

- dataset:
    name: template_allPA
    set:           template
    filepath:      '$outputdir/LLtemplates/AllPA.handlebars'
    stat_database: jobreport_json_stat
    stat_table:    datasetstat_templates
    format:        'template'
    columns:
      - { name: id,              group: "user", sort: "S", title: "PA", desc: "Username of the PA",   format: "text-left" }
      - { name: wsaccount,       group: "user", sort: "S", title: "wsaccount",
          desc: "Web service account of the PA",     format: "text-left" }
      - { name: numjobs,         group: "user",  sort: "N", title: "#Jobs", desc: "Number of queued, running and finished jobs in the last three weeks"  }
      - { name: numprojects,     group: "user",  sort: "N", title: "#Projects", desc: "Number of projects user is PA" }
      - { name: projects,        group: "user",  sort: "S", format: "text-left", title: "Projects",  desc: "List of projects user is PA", data_pre: "gen_projects_link '/data/ll/project'" }
      
- dataset:
    name: template_projectlist
    set:           template
    filepath:      '$outputdir/LLtemplates/projectlist.handlebars'
    stat_database: jobreport_json_stat
    stat_table:    datasetstat_templates
    format:        'template'
    columns:
      - { name: account,         group: "project", sort: "S", title: "Project", desc: "Project name",   format: "text-left", data_pre: "gen_project_link '/data/ll/project'" }
      - { name: ts,              group: "project", sort: "D", title: "Last Update", desc: "Date of last update of projects statistics",     format: "text-left" }
      - { name: numjobs_sum,     group: "project", sort: "N", title: "#Jobs", desc: "Number of jobs with in the project, accumulated over time and all users in project"  }
      - { name: numnodes_min,    group: "minmax",  sort: "N", title: "#Nodes (min)", desc: "Minimum number of nodes used in jobs of project" }
      - { name: numnodes_avg,    group: "project", sort: "N", title: "#Nodes (avg)", data_format: "round_number_or_null", desc: "Average number of nodes used in jobs of project" }
      - { name: numnodes_max,    group: "minmax",  sort: "N", title: "#Nodes (max)", desc: "Maximum number of nodes used in jobs of project" }
      - { name: wall_min,        group: "minmax",  sort: "N", title: "Walltime (min)",  desc: "Minimum Requested walltime (h)"  }
      - { name: wall_avg,        group: "project", sort: "N", title: "Walltime (avg)",  desc: "Average Requested walltime (h)"  }
      - { name: wall_max,        group: "minmax",  sort: "N", title: "Walltime (max)",  desc: "Maximum Requested walltime (h)"  }
      - { name: runtime_min,        group: "minmax",  sort: "N", title: "Runtime (min)",  desc: "Minimum run time (h)"  }
      - { name: runtime_avg,        group: "project", sort: "N", title: "Runtime (avg)",  desc: "Average run time (h)"  }
      - { name: runtime_max,        group: "minmax",  sort: "N", title: "Runtime (max)",  desc: "Maximum run time (h)"  }
      - { name: wallusage_min,      group: "minmax",  sort: "N", title: "Wall Usage (min)",  desc: "Minimum wall usage (%)", data_format: "round_number_or_null"  }
      - { name: wallusage_avg,      group: "project", sort: "N", title: "Wall Usage (avg)",  desc: "Average wall usage (%)", data_format: "round_number_or_null"  }
      - { name: wallusage_max,      group: "minmax",  sort: "N", title: "Wall Usage (max)",  desc: "Maximum wall usage (%)", data_format: "round_number_or_null"  }
      - { name: load_min,      group: "minmax",  sort: "N", title: "Load (min)",  desc: "Minimum load", data_format: "round_number_or_null"  }
      - { name: load_avg,      group: "project", sort: "N", title: "Load (avg)",  desc: "Average load", data_format: "round_number_or_null"  }
      - { name: load_max,      group: "minmax",  sort: "N", title: "Load (max)",  desc: "Maximum load", data_format: "round_number_or_null"  }
      - { name: usage_min,      group: "minmax",  sort: "N", title: "Usage (min)",  desc: "Minimum usage", data_format: "round_number_or_null"  }
      - { name: usage_avg,      group: "project", sort: "N", title: "Usage (avg)",  desc: "Average usage", data_format: "round_number_or_null"  }
      - { name: usage_max,      group: "minmax",  sort: "N", title: "Usage (max)",  desc: "Maximum usage", data_format: "round_number_or_null"  }
      - { name: used_cores_min,      group: "minmax",  sort: "N", title: "Used_Cores (min)",  desc: "Minimum used cores", data_format: "round_number_or_null"  }
      - { name: used_cores_avg,      group: "project", sort: "N", title: "Used_Cores (avg)",  desc: "Average used cores", data_format: "round_number_or_null"  }
      - { name: used_cores_max,      group: "minmax",  sort: "N", title: "Used_Cores (max)",  desc: "Maximum used cores", data_format: "round_number_or_null"  }
      - { name: gpu_util_min,      group: "minmax",  sort: "N", title: "GPU Usage (min)",  desc: "Minimum GPU usage", data_format: "round_number_or_null"  }
      - { name: gpu_util_avg,      group: "project", sort: "N", title: "GPU Usage (avg)",  desc: "Average GPU usage", data_format: "round_number_or_null"  }
      - { name: gpu_util_max,      group: "minmax",  sort: "N", title: "GPU Usage (max)",  desc: "Maximum GPU usage", data_format: "round_number_or_null"  }


- dataset:
    name: template_corepattern
    set:           template
    filepath:      '$outputdir/LLtemplates/corepattern.handlebars'
    stat_database: jobreport_json_stat
    stat_table:    datasetstat_templates
    format:        'template'
    columns:
      - { name: pid,             group: "pattern_extra", sort: "N", title: "Pattern ID",      desc: "Unique ID for this pattern" }
      - { name: pattern,         group: "pattern", sort: "S", title: "Pattern",  desc: "Pattern of core usage",   format: "corepattern text-left" }
      - { name: ncores_used,     group: "pattern", sort: "N", title: "#UsedCores",    desc: "Number of used cores (>25%) in jobs using this pattern"  }
      - { name: gpu,             group: "pattern", sort: "S", title: "GPU Node", desc: "Flag for GPU nodes (1) or not (0)" }
      - { name: nodeh,           group: "pattern", sort: "N", title: "Node Hours",   desc: "Total amount of node-hours spent by jobs using this pattern (in the last 3 days)", data_format: "round_number_or_null"  }
      - { name: njobs,           group: "pattern", sort: "N", title: "#Jobs",    desc: "Number of jobs using this pattern (in the last 3 days)"  }
      - { name: min_ts,          group: "pattern", sort: "N", title: "MaxAge",  desc: "Hours since first job with this pattern (in the last 3 days)", data_format: "round_number_or_null"    }
      - { name: max_ts,          group: "pattern", sort: "N", title: "MinAge",  desc: "Hours since last job with this pattern", data_format: "round_number_or_null"     }
      - { name: jobids,          group: "pattern_extra", sort: "S", title: "JobID List",    desc: "Jobs using this pattern (in the last 3 days)", format: "text-left", data_pre: "gen_jobid_list_link "  }

- dataset:
    name: template_memheatmap
    set:           template
    filepath:      '$outputdir/LLtemplates/memheatmap.handlebars'
    stat_database: jobreport_json_stat
    stat_table:    datasetstat_templates
    format:        'template'
    columns:
      - { name: memcls,          group: "heatmap", sort: "S", title: "Memory Class",   desc: "Memory usage up to xx GB" }
      - { name: n_1,             group: "heatmap", sort: "N", title: "N_1",       desc: "Percentage used by jobs of size 1",     data_format: "percent_or_null", bg_color_map: "n_1 'RdYlGn'" }
      - { name: n_2,             group: "heatmap", sort: "N", title: "N_2",       desc: "Percentage used by jobs of size 2",     data_format: "percent_or_null", bg_color_map: "n_2 'RdYlGn'" }
      - { name: n_3,             group: "heatmap", sort: "N", title: "N_3",       desc: "Percentage used by jobs of size 3",     data_format: "percent_or_null", bg_color_map: "n_3 'RdYlGn'" }
      - { name: n_4,             group: "heatmap", sort: "N", title: "N_4",       desc: "Percentage used by jobs of size 4",     data_format: "percent_or_null", bg_color_map: "n_4 'RdYlGn'" }
      - { name: n_5,             group: "heatmap", sort: "N", title: "N_5",       desc: "Percentage used by jobs of size 5",     data_format: "percent_or_null", bg_color_map: "n_5 'RdYlGn'" }
      - { name: n_6,             group: "heatmap", sort: "N", title: "N_6",       desc: "Percentage used by jobs of size 6",     data_format: "percent_or_null", bg_color_map: "n_6 'RdYlGn'" }
      - { name: n_7,             group: "heatmap", sort: "N", title: "N_7",       desc: "Percentage used by jobs of size 7",     data_format: "percent_or_null", bg_color_map: "n_7 'RdYlGn'" }
      - { name: n_8,             group: "heatmap", sort: "N", title: "N_8",       desc: "Percentage used by jobs of size 8",     data_format: "percent_or_null", bg_color_map: "n_8 'RdYlGn'" }
      - { name: n_9,             group: "heatmap", sort: "N", title: "N_9",       desc: "Percentage used by jobs of size 9",     data_format: "percent_or_null", bg_color_map: "n_9 'RdYlGn'" }
      - { name: n_10,            group: "heatmap", sort: "N", title: "N_10",      desc: "Percentage used by jobs of size 10",    data_format: "percent_or_null", bg_color_map: "n_10 'RdYlGn'" }
      - { name: n_12,            group: "heatmap", sort: "N", title: "N_12",      desc: "Percentage used by jobs of size 12",    data_format: "percent_or_null", bg_color_map: "n_12 'RdYlGn'" }
      - { name: n_16,            group: "heatmap", sort: "N", title: "N_16",      desc: "Percentage used by jobs of size 16",    data_format: "percent_or_null", bg_color_map: "n_16 'RdYlGn'" }
      - { name: n_24,            group: "heatmap", sort: "N", title: "N_24",      desc: "Percentage used by jobs of size 24",    data_format: "percent_or_null", bg_color_map: "n_24 'RdYlGn'" }
      - { name: n_32,            group: "heatmap", sort: "N", title: "N_32",      desc: "Percentage used by jobs of size 32",    data_format: "percent_or_null", bg_color_map: "n_32 'RdYlGn'" }
      - { name: n_48,            group: "heatmap", sort: "N", title: "N_48",      desc: "Percentage used by jobs of size 48",    data_format: "percent_or_null", bg_color_map: "n_48 'RdYlGn'" }
      - { name: n_64,            group: "heatmap", sort: "N", title: "N_64",      desc: "Percentage used by jobs of size 64",    data_format: "percent_or_null", bg_color_map: "n_64 'RdYlGn'" }
      - { name: n_96,            group: "heatmap", sort: "N", title: "N_96",      desc: "Percentage used by jobs of size 96",    data_format: "percent_or_null", bg_color_map: "n_96 'RdYlGn'" }
      - { name: n_128,           group: "heatmap", sort: "N", title: "N_128",     desc: "Percentage used by jobs of size 128",   data_format: "percent_or_null", bg_color_map: "n_128 'RdYlGn'" }
      - { name: n_192,           group: "heatmap", sort: "N", title: "N_192",     desc: "Percentage used by jobs of size 192",   data_format: "percent_or_null", bg_color_map: "n_192 'RdYlGn'" }
      - { name: n_256,           group: "heatmap", sort: "N", title: "N_256",     desc: "Percentage used by jobs of size 256",   data_format: "percent_or_null", bg_color_map: "n_256 'RdYlGn'" }
      - { name: n_384,           group: "heatmap", sort: "N", title: "N_384",     desc: "Percentage used by jobs of size 384",   data_format: "percent_or_null", bg_color_map: "n_384 'RdYlGn'" }
      - { name: n_512,           group: "heatmap", sort: "N", title: "N_512",     desc: "Percentage used by jobs of size 512",   data_format: "percent_or_null", bg_color_map: "n_512 'RdYlGn'" }
      - { name: n_768,           group: "heatmap", sort: "N", title: "N_768",     desc: "Percentage used by jobs of size 768",   data_format: "percent_or_null", bg_color_map: "n_768 'RdYlGn'" }
      - { name: n_1024,          group: "heatmap", sort: "N", title: "N_1024",    desc: "Percentage used by jobs of size 1024",  data_format: "percent_or_null", bg_color_map: "n_1024 'RdYlGn'" } 
      - { name: n_2048,          group: "heatmap", sort: "N", title: "N_2048",    desc: "Percentage used by jobs of size 2048",  data_format: "percent_or_null", bg_color_map: "n_2048 'RdYlGn'" }
      - { name: n_4096,          group: "heatmap", sort: "N", title: "N_4096",    desc: "Percentage used by jobs of size 4096",  data_format: "percent_or_null", bg_color_map: "n_4096 'RdYlGn'" }
      - { name: n_8192,          group: "heatmap", sort: "N", title: "N_8192",    desc: "Percentage used by jobs of size 8192",  data_format: "percent_or_null", bg_color_map: "n_8192 'RdYlGn'" }
      - { name: n_all,           group: "heatmap", sort: "N", title: "N_ALL",     desc: "Percentage used by jobs of any size",   data_format: "percent_or_null", bg_color_map: "n_all 'RdYlGn'" }

- dataset:
    name: template_CB
    set:           template
    filepath:      '$outputdir/LLtemplates/CB.handlebars'
    stat_database: jobreport_json_stat
    stat_table:    datasetstat_templates
    format:        'datatable'
    ag-grid-theme: 'balham' #quartz, balham, material, alpine (with -dark or -auto-dark suffix too)
    columns:
      - {
          field: "name",
          headerName: "Name",
          headerTooltip: "Benchmark name",
          pinned: "left",
      }
      - {
          headerName: "Timings",
          groupId: "Timings",
          children: [
            {
              field: "min_ts",
              headerName: "Date of First Run", 
              headerTooltip: "Minimum timestamp of the benchmark",
              cellDataType: "text",
            },
            {
              field: "max_ts",
              headerName: "Date of Last Run", 
              headerTooltip: "Maximum timestamp of the benchmark",
              cellDataType: "text",
            },
          ]
        }
      - {
          field: "count",
          headerName: "#Runs",
          headerTooltip: "Number of runs of the benchmark"
      }

%include "../../conf_cb/template_cb.yaml"