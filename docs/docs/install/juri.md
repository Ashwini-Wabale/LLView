# Jülich Reporting Interface

The Jülich Reporting Interface (JURI) is a JavaScript-based program that creates a Web Portal to present the data generated by LLview.

## Dependencies

As a Web Portal, most of the dependencies of JURI are placed on the browsers - it should work well at least in all the recent versions of the main ones (Firefox, Chrome and Safari).

The functioning of LLview, however - in particular, how the permissions are set -, has some requirements on the Web Server:

- Apache
    - Modules
        - mod_authz_groupfile

We use `.htgroups` and `.htaccess` files to allow the correct access for the different roles (User, Principal Investigator, Project Admin, Mentor, Admin/Support).

The groups are defined in the folder `data/sec_files/.htgroups` that is copied from the LLview Server. 
This file is configured in via the YAML files:
    ```
    $LLVIEW_CONF/server/LLgenDB/conf_jobreport/data_access/jobreport_datafiles_access_groupfile_alluser.yaml
    $LLVIEW_CONF/server/LLgenDB/conf_jobreport/data_access/jobreport_datafiles_access_groupfile_support.yaml
    ```
There, the `AuthGroupFile` may be either defined with an absolute path, or a relative to the `DocumentRoot`. 

Setup the copy of data from LLview Server to the Web Server
If necessary, create the folder where the data generated by the LLview server will be copied into (denoted here by `$LLVIEW_WEB_DATA`):
    ```
    mkdir $LLVIEW_WEB_DATA
    ```
If using the `transferreports` step described in the [LLview Server section](server.md#transferreports), make sure to have the keys in `~/.ssh/authorized_keys`. JURI includes the `rrsync.pl` tool used for copying the data, such that the key can be added as
    ```
    from="<ip of LLview Server>",command="$JURI_HOME/utils/rrsync.pl -wo $LLVIEW_WEB_DATA",no-agent-forwarding,no-port-forwarding,no-pty,no-user-rc,no-X11-forwarding <complete public part of the ssh-key>
    ```
Connect once to accept the authenticity of the host.


## Installation Instructions

- Make sure the [dependencies](#dependencies) are satisfied
- Get JURI (Jülich Reporting Interface):
    ```
    git clone https://github.com/FZJ-JSC/JURI.git
    ```
This is where the `$JURI_HOME` should be defined below, and the instructions also use this notation.
- Link JURI with the data folder: the website (HTML/CSS and JavaScript) are provided by JURI, while the data folder (denoted `$LLVIEW_WEB_DATA`) is coming from LLview Server via the `transferreports` step. 
These folders must be linked together (i.e., symbolic links will be created in `$LLVIEW_WEB_DATA`) with the script `linkjuri.sh` provided in `$JURI_HOME/utils`:
    ```
    $JURI_HOME/utils/linkjuri.sh $JURI_HOME $LLVIEW_WEB_DATA
    ```
- The access setup of the portal is done on the `.htaccess` file on the main folder `$LLVIEW_WEB_DATA` (i.e., the parent of `data/`). An example is given in JURI's repo. 
    **Note:** It is not linked with `linkjuri.sh` as this file may include sensitive data.
- The linked folder `$LLVIEW_WEB_DATA` can then be exposed to external access, e.g.:
    ```
    ln -s $LLVIEW_WEB_DATA /srv/www/htdocs/system
    ```
